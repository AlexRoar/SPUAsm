\label{index_md_README}%
\Hypertarget{index_md_README}%
 \href{https://app.codacy.com/gh/AlexRoar/SPUAsm?utm_source=github.com&utm_medium=referral&utm_content=AlexRoar/SPUAsm&utm_campaign=Badge_Grade}{\texttt{ }} \href{https://www.codefactor.io/repository/github/alexroar/spuasm}{\texttt{ }}\hypertarget{index_autotoc_md1}{}\doxysection{Description}\label{index_autotoc_md1}
This project implements code translation to uneven bytecode, disassembly tool for generated bytecode, and bytecode executor (Soft Processor Unit).

In addition, I implemented code analyser that checks for syntax mistakes. Analyser outputs info in clang format, so most I\+D\+Es highlight wrong expressions and provide descriptions of errors as well as possible solutions when possible.



During the translation, .lst file is generated. It provides information about bytecode generation and what command at what offset is located.



\href{https://alexroar.github.io/SPUAsm/html/}{\texttt{ {\bfseries{Documentation}}}}\hypertarget{index_autotoc_md2}{}\doxysection{Installation}\label{index_autotoc_md2}
Enter project\textquotesingle{}s directory and execute\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{mkdir build}
\DoxyCodeLine{cd build}
\DoxyCodeLine{cmake -\/DCMAKE\_BUILD\_TYPE=Release ..}
\DoxyCodeLine{cmake -\/-\/build .}
\end{DoxyCode}


Three files will be created\+:
\begin{DoxyItemize}
\item {\bfseries{S\+PU}} -\/ Soft Processor Unit, executes created programs
\item {\bfseries{S\+P\+U\+Asm}} -\/ translates source file (.spus) to binary file (.spub) that can be executed by S\+PU
\item {\bfseries{S\+P\+U\+Dis\+Asm}} -\/ disassembly for generated binary files
\end{DoxyItemize}\hypertarget{index_autotoc_md3}{}\doxysection{Usage}\label{index_autotoc_md3}
{\bfseries{S\+P\+U\+Asm}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\$ SPUAsm <source file>}
\DoxyCodeLine{        -\/-\/input <filename.spus>     -\/ source file (can be specified without -\/-\/input)}
\DoxyCodeLine{        -\/-\/output <filename.spub>    -\/ binary assembled file}
\DoxyCodeLine{        -\/E                          -\/ generate preprocessed file}
\DoxyCodeLine{        -\/-\/verbose                   -\/ output assembly debug information}
\DoxyCodeLine{        -\/-\/lst <filename.lst>        -\/ listing file of generated code (assembly.lst by default) }
\DoxyCodeLine{        -\/h, -\/-\/help                  -\/ show help message}
\end{DoxyCode}


{\bfseries{S\+P\+U\+Dis\+Asm}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\$ SPUDisAsm <binary file>}
\DoxyCodeLine{        -\/-\/input <filename.spub>     -\/ binary assembled file}
\DoxyCodeLine{        -\/-\/output <filename.spus>    -\/ source file (if not specified, stdout selected)}
\DoxyCodeLine{        -\/-\/verbose                   -\/ output assembly debug information}
\DoxyCodeLine{        -\/h, -\/-\/help                  -\/ show help message}
\end{DoxyCode}


{\bfseries{S\+PU}} 
\begin{DoxyCode}{0}
\DoxyCodeLine{\$ SPU <binary file>}
\DoxyCodeLine{        -\/-\/input <filename.spub>     -\/ binary assembled file}
\DoxyCodeLine{        -\/-\/output <filename.spus>    -\/ source file (if not specified, stdout selected)}
\DoxyCodeLine{        -\/-\/verbose                   -\/ output assembly debug information}
\DoxyCodeLine{        -\/-\/vsync                     -\/ render vram after every command}
\DoxyCodeLine{        -\/h, -\/-\/help                  -\/ show help message}
\end{DoxyCode}
\hypertarget{index_autotoc_md4}{}\doxysection{Algorithm description}\label{index_autotoc_md4}
Binary generation can be splitted into several parts\+:


\begin{DoxyItemize}
\item Cleanup
\item Analysis
\item Final cleanup
\item Translation
\item Final checks
\end{DoxyItemize}

If process fails on any part, the next parts are not executed.\hypertarget{index_autotoc_md5}{}\doxysubsubsection{Cleanup}\label{index_autotoc_md5}
Just double whitespaces, trailing/leading whitespaces removed. Operations that does not change code structure, lines number etc.\hypertarget{index_autotoc_md6}{}\doxysubsubsection{Analysis}\label{index_autotoc_md6}
Analyses code for syntax errors, builds temporary code to calculate labels offsets. Prints errors descriptions in clang format.\hypertarget{index_autotoc_md7}{}\doxysubsubsection{Final cleanup}\label{index_autotoc_md7}
All unnecessary indent symbols removed (comments, blank lines, unneded whitespaces). Code structure will be altered, line numbers are not preserved.\hypertarget{index_autotoc_md8}{}\doxysubsubsection{Translation}\label{index_autotoc_md8}
Code is translated using labels table generated on analysis step. At this point, all errors must be catched by analysis, but still some can make thir way to this point. In this case, generation will fail, dumping wrong instruction and its number.\hypertarget{index_autotoc_md9}{}\doxysubsubsection{Final checks}\label{index_autotoc_md9}
Check that all operations completed correctly; labels table is complete and not redundant.\hypertarget{index_autotoc_md10}{}\doxysection{Syntax}\label{index_autotoc_md10}
\hypertarget{index_autotoc_md11}{}\doxysubsection{Complex value (cvalue)}\label{index_autotoc_md11}
Operators with arguments accept {\itshape complex value} argument. Argument can be {\bfseries{assignable}} or {\bfseries{not assignable}}

Complex value examples\+:
\begin{DoxyItemize}
\item \mbox{[}rax+5\mbox{]} -\/ assignable, R\+AM on adress rax+5 with double adressation
\item 4 -\/ not assignable, immediate value 4
\item \mbox{[}5\mbox{]} -\/ assignable, R\+AM on adress 5 with double adressation
\item \mbox{[}rcx\mbox{]} -\/ assignable, R\+AM on adress rcx with double adressation
\item rcx -\/ assignable, register rcx
\item (rcx) -\/ assignable, R\+AM on adress rcx with {\bfseries{char}} adressation
\item (rcx+10) -\/ assignable, R\+AM on adress rcx+10 with {\bfseries{char}} adressation
\item (10) -\/ assignable, R\+AM on adress 10 with {\bfseries{char}} adressation
\end{DoxyItemize}

{\bfseries{Notice\+:}} whitespaces inside complex value are not allowed and considered as syntax error.\hypertarget{index_autotoc_md12}{}\doxysubsection{General purpose}\label{index_autotoc_md12}
\hypertarget{index_autotoc_md13}{}\doxysubsubsection{push    $<$any cvalue$>$}\label{index_autotoc_md13}
Push value to the stack\hypertarget{index_autotoc_md14}{}\doxysubsubsection{pop      $<$nothing/assignable cvalue$>$}\label{index_autotoc_md14}
Pop value from the stack
\begin{DoxyItemize}
\item no args -\/ just delete
\item cvalue -\/ pop and save to assignable cvalue
\end{DoxyItemize}\hypertarget{index_autotoc_md15}{}\doxysubsubsection{in          $<$nothing/assignable cvalue$>$}\label{index_autotoc_md15}
Request value from the console
\begin{DoxyItemize}
\item no args -\/ push value to the stack
\item cvalue -\/ save to assignable cvalue
\end{DoxyItemize}\hypertarget{index_autotoc_md16}{}\doxysubsubsection{out       $<$nothing/any cvalue$>$}\label{index_autotoc_md16}
Prints value to the console
\begin{DoxyItemize}
\item no args -\/ last stack value
\item cvalue -\/ cvalue value
\end{DoxyItemize}\hypertarget{index_autotoc_md17}{}\doxysubsubsection{mov       $<$assignable cvalue$>$  $<$any cvalue$>$}\label{index_autotoc_md17}
destination -\/$>$ source

Sets the first argument value to the secon argument\textquotesingle{}s value\hypertarget{index_autotoc_md18}{}\doxysubsubsection{dump}\label{index_autotoc_md18}
Dump stack information\hypertarget{index_autotoc_md19}{}\doxysubsubsection{clear}\label{index_autotoc_md19}
Clear stack\hypertarget{index_autotoc_md20}{}\doxysubsubsection{rend}\label{index_autotoc_md20}
Force render vram\hypertarget{index_autotoc_md21}{}\doxysubsubsection{slp      $<$any cvalue$>$}\label{index_autotoc_md21}
Sleep for ... nanoseconds\hypertarget{index_autotoc_md22}{}\doxysubsubsection{hlt}\label{index_autotoc_md22}
Finish the program\hypertarget{index_autotoc_md23}{}\doxysubsubsection{pixelset $<$any cvalue$>$ $<$any cvalue$>$ $<$any cvalue$>$}\label{index_autotoc_md23}
x y value

Set vram pixel (x, y) to value\hypertarget{index_autotoc_md24}{}\doxysubsubsection{clrscr}\label{index_autotoc_md24}
Fill vram with spaces\hypertarget{index_autotoc_md25}{}\doxysubsection{Math}\label{index_autotoc_md25}
\hypertarget{index_autotoc_md26}{}\doxysubsubsection{inc       $<$nothing/assignable cvalue$>$}\label{index_autotoc_md26}
Increments the value
\begin{DoxyItemize}
\item no args -\/ last stack value
\item cvalue -\/ cvalue value
\end{DoxyItemize}\hypertarget{index_autotoc_md27}{}\doxysubsubsection{dec       $<$nothing/assignable cvalue$>$}\label{index_autotoc_md27}
Decrements the value
\begin{DoxyItemize}
\item no args -\/ last stack value
\item cvalue -\/ cvalue value
\end{DoxyItemize}\hypertarget{index_autotoc_md28}{}\doxysubsubsection{add}\label{index_autotoc_md28}
Add two last stack values and push to the stack\hypertarget{index_autotoc_md29}{}\doxysubsubsection{sub}\label{index_autotoc_md29}
Substract two last stack values and push to the stack\hypertarget{index_autotoc_md30}{}\doxysubsubsection{mul}\label{index_autotoc_md30}
Multiply two last stack values and push to the stack\hypertarget{index_autotoc_md31}{}\doxysubsubsection{div}\label{index_autotoc_md31}
Divide two last stack values and push to the stack\hypertarget{index_autotoc_md32}{}\doxysubsubsection{sin}\label{index_autotoc_md32}
Sin of the last stack value\hypertarget{index_autotoc_md33}{}\doxysubsubsection{cos}\label{index_autotoc_md33}
Cos of the last stack value\hypertarget{index_autotoc_md34}{}\doxysubsubsection{abs}\label{index_autotoc_md34}
Abs of the last stack value\hypertarget{index_autotoc_md35}{}\doxysubsubsection{sqrt}\label{index_autotoc_md35}
Square root of the last stack value\hypertarget{index_autotoc_md36}{}\doxysubsubsection{pow}\label{index_autotoc_md36}
The pre-\/last element of the stack to the power of the last one\hypertarget{index_autotoc_md37}{}\doxysubsection{Codeflow modifiers}\label{index_autotoc_md37}
\hypertarget{index_autotoc_md38}{}\doxysubsubsection{call       $<$label$>$}\label{index_autotoc_md38}
Gives execution to the label block. Can be returned to the call instruction using {\itshape ret}\hypertarget{index_autotoc_md39}{}\doxysubsubsection{ret}\label{index_autotoc_md39}
Returnes to the last call position. May fail if there were no calls.\hypertarget{index_autotoc_md40}{}\doxysubsubsection{jmp      $<$label$>$}\label{index_autotoc_md40}
Jump to the label\hypertarget{index_autotoc_md41}{}\doxysubsubsection{jb         $<$label$>$}\label{index_autotoc_md41}
Jump if last element is bigger than pre-\/last. Removes both operands from the stack\hypertarget{index_autotoc_md42}{}\doxysubsubsection{jbe       $<$label$>$}\label{index_autotoc_md42}
Jump if last element is bigger-\/or-\/equal than pre-\/last. Removes both operands from the stack\hypertarget{index_autotoc_md43}{}\doxysubsubsection{je         $<$label$>$}\label{index_autotoc_md43}
Jump if last element is equal to the pre-\/last one. Removes both operands from the stack\hypertarget{index_autotoc_md44}{}\doxysubsubsection{jne       $<$label$>$}\label{index_autotoc_md44}
Jump if last element is not equal to the pre-\/last one. Removes both operands from the stack\hypertarget{index_autotoc_md45}{}\doxysubsubsection{ja         $<$label$>$}\label{index_autotoc_md45}
Jump if last element is lower than pre-\/last. Removes both operands from the stack\hypertarget{index_autotoc_md46}{}\doxysubsubsection{jae       $<$label$>$}\label{index_autotoc_md46}
Jump if last element is lower-\/or-\/equal than pre-\/last. Removes both operands from the stack\hypertarget{index_autotoc_md47}{}\doxysubsubsection{jm        $<$label$>$}\label{index_autotoc_md47}
Jump if it\textquotesingle{}s Monday.\hypertarget{index_autotoc_md48}{}\doxysubsubsection{label\+Name\+:}\label{index_autotoc_md48}
Creates label\hypertarget{index_autotoc_md49}{}\doxysection{Examples}\label{index_autotoc_md49}
All examples are available \href{https://github.com/AlexRoar/SPUAsm/tree/main/Examples/SPUAsm/SPUAsm}{\texttt{ in this dir}}.\hypertarget{index_autotoc_md50}{}\doxysubsection{Squares of first n numbers}\label{index_autotoc_md50}

\begin{DoxyCode}{0}
\DoxyCodeLine{;}
\DoxyCodeLine{; Squares}
\DoxyCodeLine{;}
\DoxyCodeLine{}
\DoxyCodeLine{in rbx  ; rbx as counter}
\DoxyCodeLine{}
\DoxyCodeLine{push 0}
\DoxyCodeLine{pop rax}
\DoxyCodeLine{}
\DoxyCodeLine{loop:}
\DoxyCodeLine{dec rbx  ; decrease counter}
\DoxyCodeLine{}
\DoxyCodeLine{; Calculating square}
\DoxyCodeLine{push rax}
\DoxyCodeLine{push rax}
\DoxyCodeLine{mul}
\DoxyCodeLine{out}
\DoxyCodeLine{}
\DoxyCodeLine{; Prepare for the next loop}
\DoxyCodeLine{pop}
\DoxyCodeLine{inc rax}
\DoxyCodeLine{}
\DoxyCodeLine{jm mondayOnly ; exit if it is monday}
\DoxyCodeLine{}
\DoxyCodeLine{; Insert conditional jump operands}
\DoxyCodeLine{push 0}
\DoxyCodeLine{push rbx}
\DoxyCodeLine{}
\DoxyCodeLine{jne loop}
\DoxyCodeLine{}
\DoxyCodeLine{mondayOnly:}
\end{DoxyCode}
\hypertarget{index_autotoc_md51}{}\doxysubsection{Popping circles}\label{index_autotoc_md51}



\begin{DoxyCode}{0}
\DoxyCodeLine{; height 32}
\DoxyCodeLine{; width  64}
\DoxyCodeLine{}
\DoxyCodeLine{push 32}
\DoxyCodeLine{push 16}
\DoxyCodeLine{push 10}
\DoxyCodeLine{push 35}
\DoxyCodeLine{call drawCircle}
\DoxyCodeLine{}
\DoxyCodeLine{clrscr}
\DoxyCodeLine{}
\DoxyCodeLine{push 32}
\DoxyCodeLine{push 16}
\DoxyCodeLine{push 4}
\DoxyCodeLine{push 42}
\DoxyCodeLine{call drawCircle}
\DoxyCodeLine{}
\DoxyCodeLine{clrscr}
\DoxyCodeLine{}
\DoxyCodeLine{push 16}
\DoxyCodeLine{push 8}
\DoxyCodeLine{push 2}
\DoxyCodeLine{push 42}
\DoxyCodeLine{call drawCircle}
\DoxyCodeLine{}
\DoxyCodeLine{clrscr}
\DoxyCodeLine{rend}
\DoxyCodeLine{}
\DoxyCodeLine{push 40}
\DoxyCodeLine{push 25}
\DoxyCodeLine{push 4}
\DoxyCodeLine{push 48}
\DoxyCodeLine{call drawCircle}
\DoxyCodeLine{}
\DoxyCodeLine{clrscr}
\DoxyCodeLine{rend}
\DoxyCodeLine{}
\DoxyCodeLine{push 60}
\DoxyCodeLine{push 13}
\DoxyCodeLine{push 8}
\DoxyCodeLine{push 48}
\DoxyCodeLine{call drawCircle}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{hlt}
\DoxyCodeLine{}
\DoxyCodeLine{drawCircle: ;(x0, y0, r, symbol)}
\DoxyCodeLine{    pop [2]}
\DoxyCodeLine{    pop rcx  ; r}
\DoxyCodeLine{    pop rbx  ; y0}
\DoxyCodeLine{    pop rax  ; x0}
\DoxyCodeLine{}
\DoxyCodeLine{    mov rdx 0   ; initial angle}
\DoxyCodeLine{    loop:}
\DoxyCodeLine{        push rbx}
\DoxyCodeLine{        push rdx}
\DoxyCodeLine{        sin}
\DoxyCodeLine{        push rcx}
\DoxyCodeLine{        mul}
\DoxyCodeLine{        add ; y0 + r*sin(alpha)}
\DoxyCodeLine{}
\DoxyCodeLine{        pop [0] ; y coordinate}
\DoxyCodeLine{}
\DoxyCodeLine{        push rax}
\DoxyCodeLine{        push rdx}
\DoxyCodeLine{        cos}
\DoxyCodeLine{        push rcx}
\DoxyCodeLine{        push 2}
\DoxyCodeLine{        mul}
\DoxyCodeLine{        mul}
\DoxyCodeLine{        add ; x0 + r*cos(alpha)}
\DoxyCodeLine{}
\DoxyCodeLine{        pop [1] ; x coordinate}
\DoxyCodeLine{}
\DoxyCodeLine{        pixset [1] [0] [2]}
\DoxyCodeLine{        }
\DoxyCodeLine{        rend}
\DoxyCodeLine{        slp 10000}
\DoxyCodeLine{    ; loop params}
\DoxyCodeLine{    mov rdx rdx+0.1}
\DoxyCodeLine{    push rdx}
\DoxyCodeLine{    push 3.1415926535897}
\DoxyCodeLine{    push 2}
\DoxyCodeLine{    mul}
\DoxyCodeLine{    jbe loop}
\DoxyCodeLine{    ret}
\end{DoxyCode}
\hypertarget{index_autotoc_md52}{}\doxysubsection{Square equation solutions}\label{index_autotoc_md52}

\begin{DoxyCode}{0}
\DoxyCodeLine{;}
\DoxyCodeLine{; Data input}
\DoxyCodeLine{; (a, b, c)}
\DoxyCodeLine{;}
\DoxyCodeLine{in      rax}
\DoxyCodeLine{in      rbx}
\DoxyCodeLine{in      rcx}
\DoxyCodeLine{}
\DoxyCodeLine{;}
\DoxyCodeLine{; D calculation}
\DoxyCodeLine{;}
\DoxyCodeLine{push    rbx}
\DoxyCodeLine{push    2}
\DoxyCodeLine{pow}
\DoxyCodeLine{}
\DoxyCodeLine{push    4}
\DoxyCodeLine{push    rax}
\DoxyCodeLine{mul}
\DoxyCodeLine{push    rcx}
\DoxyCodeLine{mul}
\DoxyCodeLine{sub}
\DoxyCodeLine{sqrt}
\DoxyCodeLine{pop     rdx}
\DoxyCodeLine{}
\DoxyCodeLine{}
\DoxyCodeLine{;}
\DoxyCodeLine{; First x}
\DoxyCodeLine{;}
\DoxyCodeLine{clear}
\DoxyCodeLine{push    -\/1}
\DoxyCodeLine{push    rbx}
\DoxyCodeLine{mul}
\DoxyCodeLine{push    rdx}
\DoxyCodeLine{sub}
\DoxyCodeLine{push    2}
\DoxyCodeLine{div}
\DoxyCodeLine{push    rax}
\DoxyCodeLine{div}
\DoxyCodeLine{pop     rcx}
\DoxyCodeLine{}
\DoxyCodeLine{;}
\DoxyCodeLine{; Second x}
\DoxyCodeLine{;}
\DoxyCodeLine{clear}
\DoxyCodeLine{push    -\/1}
\DoxyCodeLine{push    rbx}
\DoxyCodeLine{mul}
\DoxyCodeLine{push    rdx}
\DoxyCodeLine{add}
\DoxyCodeLine{push    2}
\DoxyCodeLine{div}
\DoxyCodeLine{push    rax}
\DoxyCodeLine{div}
\DoxyCodeLine{pop     rax}
\DoxyCodeLine{}
\DoxyCodeLine{;}
\DoxyCodeLine{; Output}
\DoxyCodeLine{;}
\DoxyCodeLine{out     rax}
\DoxyCodeLine{out     rcx}
\end{DoxyCode}
\hypertarget{index_autotoc_md53}{}\doxysection{Links}\label{index_autotoc_md53}

\begin{DoxyItemize}
\item \href{https://github.com/AlexRoar/SPUAsm/blob/main/SoftProcessorUnit/Assembly/SPUAssembly.cpp}{\texttt{ S\+P\+U\+Asm code}}
\item \href{https://github.com/AlexRoar/SPUAsm/blob/main/SoftProcessorUnit/Disassembly/SPUDisAssembly.cpp}{\texttt{ S\+P\+U\+Dis\+Asm code}}
\item \href{https://github.com/AlexRoar/SPUAsm/blob/main/SoftProcessorUnit/SPU/SPU.cpp}{\texttt{ S\+PU code}}
\item \href{https://github.com/AlexRoar/SPUAsm/tree/main/Examples/SPUAsm/SPUAsm}{\texttt{ Examples}} 
\end{DoxyItemize}