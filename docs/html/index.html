<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SPU: Assembly-type code translator and SPU-executor</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SPU
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Assembly-type code translator and SPU-executor </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> <a href="https://app.codacy.com/gh/AlexRoar/SPUAsm?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=AlexRoar/SPUAsm&amp;utm_campaign=Badge_Grade"><img src="https://api.codacy.com/project/badge/Grade/0ef56e0968ad4689a264716b9becbd09" alt="Codacy Badge" class="inline"/></a> <a href="https://www.codefactor.io/repository/github/alexroar/spuasm"><img src="https://www.codefactor.io/repository/github/alexroar/spuasm/badge" alt="CodeFactor" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Description</h1>
<p>This project implements code translation to uneven bytecode, disassembly tool for generated bytecode, and bytecode executor (Soft Processor Unit).</p>
<p>In addition, I implemented code analyser that checks for syntax mistakes. Analyser outputs info in clang format, so most IDEs highlight wrong expressions and provide descriptions of errors as well as possible solutions when possible.</p>
<p><img src="https://github.com/AlexRoar/SPUAsm/raw/main/Images/errors.png" alt="" style="max-height: 100px" class="inline"/></p>
<p>During the translation, .lst file is generated. It provides information about bytecode generation and what command at what offset is located.</p>
<p><img src="https://github.com/AlexRoar/SPUAsm/raw/main/Images/generalview.png" alt="" style="max-height: 250px" class="inline"/></p>
<p><a href="https://alexroar.github.io/SPUAsm/html/"><b>Documentation</b></a></p>
<h1><a class="anchor" id="autotoc_md2"></a>
Installation</h1>
<p>Enter project's directory and execute:</p>
<div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">cmake --build .</div>
</div><!-- fragment --><p>Three files will be created:</p><ul>
<li><b>SPU</b> - Soft Processor Unit, executes created programs</li>
<li><b>SPUAsm</b> - translates source file (.spus) to binary file (.spub) that can be executed by SPU</li>
<li><b>SPUDisAsm</b> - disassembly for generated binary files</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Usage</h1>
<p><b>SPUAsm</b> </p><div class="fragment"><div class="line">$ SPUAsm &lt;source file&gt;</div>
<div class="line">        --input &lt;filename.spus&gt;     - source file (can be specified without --input)</div>
<div class="line">        --output &lt;filename.spub&gt;    - binary assembled file</div>
<div class="line">        -E                          - generate preprocessed file</div>
<div class="line">        --verbose                   - output assembly debug information</div>
<div class="line">        --lst &lt;filename.lst&gt;        - listing file of generated code (assembly.lst by default) </div>
<div class="line">        -h, --help                  - show help message</div>
</div><!-- fragment --><p><b>SPUDisAsm</b> </p><div class="fragment"><div class="line">$ SPUDisAsm &lt;binary file&gt;</div>
<div class="line">        --input &lt;filename.spub&gt;     - binary assembled file</div>
<div class="line">        --output &lt;filename.spus&gt;    - source file (if not specified, stdout selected)</div>
<div class="line">        --verbose                   - output assembly debug information</div>
<div class="line">        -h, --help                  - show help message</div>
</div><!-- fragment --><p><b>SPU</b> </p><div class="fragment"><div class="line">$ SPU &lt;binary file&gt;</div>
<div class="line">        --input &lt;filename.spub&gt;     - binary assembled file</div>
<div class="line">        --output &lt;filename.spus&gt;    - source file (if not specified, stdout selected)</div>
<div class="line">        --verbose                   - output assembly debug information</div>
<div class="line">        -h, --help                  - show help message</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Algorithm description</h1>
<p>Binary generation can be splitted into several parts:</p>
<ul>
<li>Cleanup</li>
<li>Analysis</li>
<li>Final cleanup</li>
<li>Translation</li>
<li>Final checks</li>
</ul>
<p>If process fails on any part, the next parts are not executed.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
Cleanup</h3>
<p>Just double whitespaces, trailing/leading whitespaces removed. Operations that does not change code structure, lines number etc.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
Analysis</h3>
<p>Analyses code for syntax errors, builds temporary code to calculate labels offsets. Prints errors descriptions in clang format.</p>
<h3><a class="anchor" id="autotoc_md7"></a>
Final cleanup</h3>
<p>All unnecessary indent symbols removed (comments, blank lines, unneded whitespaces). Code structure will be altered, line numbers are not preserved.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Translation</h3>
<p>Code is translated using labels table generated on analysis step. At this point, all errors must be catched by analysis, but still some can make thir way to this point. In this case, generation will fail, dumping wrong instruction and its number.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Final checks</h3>
<p>Check that all operations completed correctly; labels table is complete and not redundant.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Syntax</h1>
<h3><a class="anchor" id="autotoc_md11"></a>
push    &lt;instant value/register&gt;</h3>
<p>Push value to the stack</p>
<h3><a class="anchor" id="autotoc_md12"></a>
pop      &lt;empty/register&gt;</h3>
<p>Pop value from the stack</p><ul>
<li>no args - just delete</li>
<li>register - pop and save to register</li>
</ul>
<h3><a class="anchor" id="autotoc_md13"></a>
in          &lt;empty/register&gt;</h3>
<p>Request value from the console</p><ul>
<li>no args - push value to the stack</li>
<li>register - save to the register</li>
</ul>
<h3><a class="anchor" id="autotoc_md14"></a>
out       &lt;empty/register&gt;</h3>
<p>Prints value to the console</p><ul>
<li>no args - last stack value</li>
<li>register - register value</li>
</ul>
<h3><a class="anchor" id="autotoc_md15"></a>
inc       &lt;empty/register&gt;</h3>
<p>Increments the value</p><ul>
<li>no args - increment the last stack element</li>
<li>register - increment the register</li>
</ul>
<h3><a class="anchor" id="autotoc_md16"></a>
dec      &lt;empty/register&gt;</h3>
<p>Decrements the value</p><ul>
<li>no args - increment the last stack element</li>
<li>register - increment the register</li>
</ul>
<h3><a class="anchor" id="autotoc_md17"></a>
dump</h3>
<p>Dump stack information</p>
<h3><a class="anchor" id="autotoc_md18"></a>
clear</h3>
<p>Clear stack</p>
<h3><a class="anchor" id="autotoc_md19"></a>
add</h3>
<p>Add two last stack values and push to the stack</p>
<h3><a class="anchor" id="autotoc_md20"></a>
sub</h3>
<p>Substract two last stack values and push to the stack</p>
<h3><a class="anchor" id="autotoc_md21"></a>
mul</h3>
<p>Multiply two last stack values and push to the stack</p>
<h3><a class="anchor" id="autotoc_md22"></a>
div</h3>
<p>Divide two last stack values and push to the stack</p>
<h3><a class="anchor" id="autotoc_md23"></a>
sin</h3>
<p>Sin of the last stack value</p>
<h3><a class="anchor" id="autotoc_md24"></a>
cos</h3>
<p>Cos of the last stack value</p>
<h3><a class="anchor" id="autotoc_md25"></a>
sqrt</h3>
<p>Square root of the last stack value</p>
<h3><a class="anchor" id="autotoc_md26"></a>
pow</h3>
<p>The pre-last element of the stack to the power of the last one</p>
<h3><a class="anchor" id="autotoc_md27"></a>
het</h3>
<p>Finish the program</p>
<h3><a class="anchor" id="autotoc_md28"></a>
jmp      &lt;label&gt;</h3>
<p>Jump to the label</p>
<h3><a class="anchor" id="autotoc_md29"></a>
jb         &lt;label&gt;</h3>
<p>Jump if last element is bigger than pre-last. Removes both operands from the stack</p>
<h3><a class="anchor" id="autotoc_md30"></a>
jbe       &lt;label&gt;</h3>
<p>Jump if last element is bigger-or-equal than pre-last. Removes both operands from the stack</p>
<h3><a class="anchor" id="autotoc_md31"></a>
je         &lt;label&gt;</h3>
<p>Jump if last element is equal to the pre-last one. Removes both operands from the stack</p>
<h3><a class="anchor" id="autotoc_md32"></a>
jne       &lt;label&gt;</h3>
<p>Jump if last element is not equal to the pre-last one. Removes both operands from the stack</p>
<h3><a class="anchor" id="autotoc_md33"></a>
ja         &lt;label&gt;</h3>
<p>Jump if last element is lower than pre-last. Removes both operands from the stack</p>
<h3><a class="anchor" id="autotoc_md34"></a>
jae       &lt;label&gt;</h3>
<p>Jump if last element is lower-or-equal than pre-last. Removes both operands from the stack</p>
<h3><a class="anchor" id="autotoc_md35"></a>
jm        &lt;label&gt;</h3>
<p>Jump if it's Monday.</p>
<h3><a class="anchor" id="autotoc_md36"></a>
labelName:</h3>
<p>Creates label</p>
<h1><a class="anchor" id="autotoc_md37"></a>
Examples</h1>
<p>All examples are available <a href="https://github.com/AlexRoar/SPUAsm/tree/main/Examples/SPUAsm/SPUAsm">in this dir</a>.</p>
<h2><a class="anchor" id="autotoc_md38"></a>
Squares of first n numbers</h2>
<div class="fragment"><div class="line">;</div>
<div class="line">; Squares</div>
<div class="line">;</div>
<div class="line"> </div>
<div class="line">in rbx  ; rbx as counter</div>
<div class="line"> </div>
<div class="line">push 0</div>
<div class="line">pop rax</div>
<div class="line"> </div>
<div class="line">loop:</div>
<div class="line">dec rbx  ; decrease counter</div>
<div class="line"> </div>
<div class="line">; Calculating square</div>
<div class="line">push rax</div>
<div class="line">push rax</div>
<div class="line">mul</div>
<div class="line">out</div>
<div class="line"> </div>
<div class="line">; Prepare for the next loop</div>
<div class="line">pop</div>
<div class="line">inc rax</div>
<div class="line"> </div>
<div class="line">jm mondayOnly ; exit if it is monday</div>
<div class="line"> </div>
<div class="line">; Insert conditional jump operands</div>
<div class="line">push 0</div>
<div class="line">push rbx</div>
<div class="line"> </div>
<div class="line">jne loop</div>
<div class="line"> </div>
<div class="line">mondayOnly:</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md39"></a>
Square equation solutions</h2>
<div class="fragment"><div class="line">;</div>
<div class="line">; Data input</div>
<div class="line">; (a, b, c)</div>
<div class="line">;</div>
<div class="line">in      rax</div>
<div class="line">in      rbx</div>
<div class="line">in      rcx</div>
<div class="line"> </div>
<div class="line">;</div>
<div class="line">; D calculation</div>
<div class="line">;</div>
<div class="line">push    rbx</div>
<div class="line">push    2</div>
<div class="line">pow</div>
<div class="line"> </div>
<div class="line">push    4</div>
<div class="line">push    rax</div>
<div class="line">mul</div>
<div class="line">push    rcx</div>
<div class="line">mul</div>
<div class="line">sub</div>
<div class="line">sqrt</div>
<div class="line">pop     rdx</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">;</div>
<div class="line">; First x</div>
<div class="line">;</div>
<div class="line">clear</div>
<div class="line">push    -1</div>
<div class="line">push    rbx</div>
<div class="line">mul</div>
<div class="line">push    rdx</div>
<div class="line">sub</div>
<div class="line">push    2</div>
<div class="line">div</div>
<div class="line">push    rax</div>
<div class="line">div</div>
<div class="line">pop     rcx</div>
<div class="line"> </div>
<div class="line">;</div>
<div class="line">; Second x</div>
<div class="line">;</div>
<div class="line">clear</div>
<div class="line">push    -1</div>
<div class="line">push    rbx</div>
<div class="line">mul</div>
<div class="line">push    rdx</div>
<div class="line">add</div>
<div class="line">push    2</div>
<div class="line">div</div>
<div class="line">push    rax</div>
<div class="line">div</div>
<div class="line">pop     rax</div>
<div class="line"> </div>
<div class="line">;</div>
<div class="line">; Output</div>
<div class="line">;</div>
<div class="line">out     rax</div>
<div class="line">out     rcx</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md40"></a>
Links</h1>
<ul>
<li><a href="https://github.com/AlexRoar/SPUAsm/blob/main/SoftProcessorUnit/Assembly/SPUAssembly.cpp">SPUAsm code</a></li>
<li><a href="https://github.com/AlexRoar/SPUAsm/blob/main/SoftProcessorUnit/Disassembly/SPUDisAssembly.cpp">SPUDisAsm code</a></li>
<li><a href="https://github.com/AlexRoar/SPUAsm/blob/main/SoftProcessorUnit/SPU/SPU.cpp">SPU code</a></li>
<li><a href="https://github.com/AlexRoar/SPUAsm/tree/main/Examples/SPUAsm/SPUAsm">Examples</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
